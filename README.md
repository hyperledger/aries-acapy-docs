# Aries ACA-Py Docs

## Setup

Everything can be run with simple commands from the [`./manage`](./manage) script.

## Reqirements

You should have [Docker](https://docs.docker.com/get-docker/) installed and running.

## Environment Setup

Run `./manage build` from the root of this directory to build the `acapy-docs` Docker image. It will be bundled with all of the tooling for building the docs.

## Building Docs

Run `./manage build-docs` from the root of this directory.

This will first prompt you to authenticate your GitHub account in order to checkout the [Aries Cloudagent Python](https://github.com/hyperledger/aries-cloudagent-python) repo and to compile the markdown files from that repo.

Upon successful authentication, the script will compile the docs and arrange then in the correct directories locally.

From here you can simply push them to GitHub or you can [view them locally](#local-development).

### Options

The following options can be applied to the `./manage build-docs` command. They are optional.

- `-m`: run modifications on compiled docs

  See [Modifications](#modifications) for more information on transforming compiled docs.

- `-t`: build docs from a specific ACA-Py release tag

  By default docs will be compiled from the `main` branch. If you would like to compile docs from a release branch, for example `0.8.0-rc0`, you can supply that here.

## Modifications

_Note: the mechanism here uses a Node.js script to supply modifications to docs files. This can alternatively and easily be done/replaced with a shell script that utilizes a stream editor command._

Compiled docs may not be completely formatted correctly for Docusaurus. A mechanism has been provided to modify compiled docs files for this. Modifications are simply JavaScript modules that are exported from the [`./modifiers`](/modifiers/) directory. Modules are named according to the ACA-Py branch the docs are compiled from. As an example there is a modifier for both the `main` ([`main.js`](/modifiers/main.js)) branch and the `0.8.0-rc0` ([`0.8.0-rc0.js`](/modifiers/0.8.0-rc0.js)) release branch for reference.

Modules export an object who's keys correspond to the local path of a document that should be modified. The value is another object with options to supply a string `title` and/or a `modifications` object who's keys are document text that should be replaced by the objects values.

For example:

```js
module.exports = {
  [path.resolve(__dirname, "../docs/admin/PUBLISHING.md")]: {
    title: "How to Publish a New Version",
    modifiers: {
      [`[Container Images and Github Actions]()`]: `_Container Images and Github Actions_`,
    },
  },
};
```

In this case the `docs/admin/PUBLISHING.md` file will be modified to add YAML frontmatter with the title: 'How to Publish a New Version', and will have the markdown link replaced with italicized text. You can apply as many modifiers as you'd like for a file but only one title can be specified.

In combination with the `-m` option above, supplying the `-t` option will run a modification module with that release branch name, otherwise `-m` on its own will apply modifications to the `main` docs. If a named modification module is not found, an error is thrown.

## Autogenerated by Docusaurus

The following is documentation generated by Docusaurus. You may find the [Local Development](#local-development) section useful for testing the docs on your local machine before pushing to GitHub. [Build](#build) and [Deployment](#deployment) is handled by a GitHub Action when updates are made to the docs and pushed to GitHub. Therefore these sections may not be as relevant.

### Website

This website is built using [Docusaurus 2](https://docusaurus.io/), a modern static website generator.

#### Installation

```
$ yarn
```

#### Local Development

```
$ yarn start
```

This command starts a local development server and opens up a browser window. Most changes are reflected live without having to restart the server.

#### Build

```
$ yarn build
```

This command generates static content into the `build` directory and can be served using any static contents hosting service.

#### Deployment

Using SSH:

```
$ USE_SSH=true yarn deploy
```

Not using SSH:

```
$ GIT_USER=<Your GitHub username> yarn deploy
```

If you are using GitHub pages for hosting, this command is a convenient way to build the website and push to the `gh-pages` branch.
